function ZueAjax(){this.eventManager=undefined;this.defaults={method:"get",data:"",url:undefined,model:undefined,success:function(){},failure:function(){},trap:false};this.$=jQuery}ZueAjax.prototype.setEventManager=function(e){this.eventManager=e};ZueAjax.prototype.exec=function(e){var t=this.$;var r=t.extend({},this._defaults,e);var i=this.eventManager;var n={type:r.method,url:r.url,success:function(e){if(detectArray(e)){if(e.length==0){if(!r.trap){i.trigger(HUE_ERROR,{type:10001,description:"empty result set"})}r.failure()}for(var n in e){if(e.hasOwnProperty(n)){e[n]._i=n;if("error"in e[n]){if(!r.trap){i.trigger(HUE_ERROR,e[n].error)}r.failure()}else{var a=t.extend(true,{},r.model);a.exchangeData(e[n]);r.success(a)}}}}else if(typeof e==="object"){if("error"in e){if(!r.trap){i.trigger(HUE_ERROR,e.error)}r.failure()}else{r.model.exchangeData(e);r.success(r.model)}}else{throw"`data` is not something I can work with"}},error:function(){if(!r.trap){i.trigger(HUE_ERROR,{type:1e4,description:"no/bad response from server"})}r.failure()}};if(r.method=="post"||r.method=="put"){n.data=JSON.stringify(r.data)}t.ajax(n)};function ZueEventManager(){this.o={}}ZueEventManager.prototype.attach=function(e,t,r){if(this.o[e]===undefined){this.o[e]=[]}var i={};i.callback=t;i.object=r;this.o[e].push(i)};ZueEventManager.prototype.trigger=function(e,t){if(detectArray(this.o[e])){for(var r=0;r<this.o[e].length;r++){var i=this.o[e][r];if(i.object===undefined){i.callback(t)}else{i.callback.call(i.object,t)}}}};var HUE_ERROR="core.hue_error";var ERR_UNAUTHORIZED=1;var ERR_LINK_BUTTON_NOT_PRESSED=101;var LIGHT_ADDED="lights.light_added";var LIGHT_UPDATING="lights.light_updating";var LIGHT_UPDATED="lights.light_updated";var GROUP_ADDED="groups.group_added";var GROUP_LIGHT_ADDED="groups.light_added";var GROUP_UPDATING="groups.group_updating";var GROUP_UPDATED="groups.group_updated";var BRIDGE_FOUND="bridge.bridge_found";var NO_BRIDGE_FOUND="bridge.no_bridge_found";var LINK_SUCCESS="config.link_success";var LINK_FAILURE="config.link_failure";var LINK_BEGIN="config.link_begin";var LINKED="config.linked";var detectArray=function(e){if(e!==undefined&&!!e.shift){return true}if(typeof e!=="object"){return false}var t=false;for(var r in e){if(e.hasOwnProperty(r)){t=true;if(isNaN(parseInt(r,10))){return false}}}return t};function ZueCore(e,t){this.modules={};this.plugins={};this.IAjax=e;this.IAjax.setEventManager(t);this.IEventManager=t;this.log_target="#zue-debug";this.triggers=0}ZueCore.prototype.log=function(e){if($(this.log_target).length){$(this.log_target).prepend($("<div/>").text(this.triggers++ +" "+e))}};ZueCore.prototype.attach=function(e,t){this.modules[e]=t(this);this[e]=this.modules[e]};ZueCore.prototype.enablePlugin=function(e){this.plugins[e].start(this)};ZueCore.prototype.registerPlugin=function(e,t){this.plugins[e]=t};ZueCore.prototype.triggerEvent=function(e,t,r){this.log("event: "+e+" Arg: "+JSON.stringify(t));this.IEventManager.trigger(e,t,r)};ZueCore.prototype.listenFor=function(e,t,r){this.IEventManager.attach(e,t,r)};ZueCore.prototype.on=function(e,t,r){this.listenFor(e,t,r)};ZueCore.prototype.ajaxExec=function(e){this.log("ajax:  "+e.method+" "+e.url);this.IAjax.exec(e)};window.zue=new ZueCore(new ZueAjax,new ZueEventManager);function Bridge(){this.id="";this.internalipaddress="";this.macaddress="";this.hue_username=undefined;this.protocol="http";this.URL_API_PART="/api";this.error=""}Bridge.prototype.exchangeData=function(e){if("id"in e)this.id=e.id;if("internalipaddress"in e)this.internalipaddress=e.internalipaddress;if("macaddress"in e)this.macaddress=e.macaddress;if("hue_username"in e)this.hue_username=e.hue_username;if("error"in e)this.error=e.error.type;if("success"in e)this.hue_username=e.success.username};Bridge.prototype.assembleUrl=function(e){return this.protocol+"://"+this.internalipaddress+this.URL_API_PART+"/"+this.hue_username+e};Bridge.prototype.assembleRootUrl=function(){return this.protocol+"://"+this.internalipaddress+this.URL_API_PART};var _bridgeZueModule=function(e){"use strict";var t="https://www.meethue.com/api/nupnp";var r=function(t){e.triggerEvent(BRIDGE_FOUND,t);return"_bridgeZueModule.foundBridge"};var i=function(){e.triggerEvent(NO_BRIDGE_FOUND);return"_bridgeZueModule.noBridgeFound"};var n=function(){var n=new Bridge;n=e.ajaxExec({url:t,model:n,success:r,failure:i,trap:true})};return{locate:n,_foundBridge:r,_noBridgeFound:i}};zue.attach("bridge",_bridgeZueModule);var _configZueModule=function(e){"use strict";var t=";zue-powered";var r=40;var i=6e4;var n=5e3;var a={};var s=function(e){event_manager.trigger(LINKED,e)};var o=function(e,t){event_manager.trigger(LINK_BEGIN,e);ajax.exec({url:e.assembleRootUrl(),type:"post",data:t,model:e,success:s})};var u=function(e){return{devicetype:e.substr(0,r-t.length)+t}};var h=function(e,t){o(e,u(t))};var g=function(e,t,r){var i=u(t);i.username=r;o(e,i)};return{createUser:g,createAnonUser:h,_createUser:o}};zue.attach("config",_configZueModule);function Light(){this.id="";this.name="";this.simple=true;this.state={on:false,bri:0,hue:0,sat:0,xy:[0,0],alert:"none",effect:"none",colormode:"hs",reachable:true};this.type="";this.modelid="";this.swversion="";this.pointsymbol={};this.bridge=undefined}Light.prototype.exchangeData=function(e){if("_i"in e&&!this.id)this.id=e._i;this.name=e.name||"";this.simple=!("state"in e);if(!this.simple){this.state=e.state;this.type=e.type;this.modelid=e.modelid;this.swversion=e.swversion;this.pointsymbol=e.pointsymbol}};Light.prototype.toggle=function(){zue.lights.updateLightState(this,{on:!this.state.on})};Light.prototype.setHue=function(e){zue.lights.updateLightState(this,{hue:e})};Light.prototype.setBri=function(e){zue.lights.updateLightState(this,{bri:e})};Light.prototype.setSat=function(e){zue.lights.updateLightState(this,{sat:e})};function LightUpdateResponse(){this.light="";this.status="failure"}LightUpdateResponse.prototype.exchangeData=function(e){if("success"in e){this.status="success"}};var _lightsZueModule=function(e){"use strict";var t="/lights";var r="/state";var i=function(t){e.triggerEvent(LIGHT_ADDED,t)};var n=function(r){if(r.status=="success"){var i=r.light;var n=i.bridge.assembleUrl(t+"/"+i.id);e.ajaxExec({url:n,model:i,success:a})}};var a=function(t){e.triggerEvent(LIGHT_UPDATED,t)};var s=function(r){var n=r.assembleUrl(t);var a=new Light;a.bridge=r;e.ajaxExec({url:n,model:a,success:i})};var o=function(r){var n=r.bridge.assembleUrl(t+"/"+r.id);e.ajaxExec({url:n,model:r,success:i})};var u=function(i,a){var s=i.bridge.assembleUrl(t+"/"+i.id+r);var o=new LightUpdateResponse;o.light=i;e.triggerEvent(LIGHT_UPDATING,i);e.ajaxExec({url:s,model:o,method:"put",data:a,success:n})};return{getAllLights:s,getLightDetails:o,updateLightState:u}};zue.attach("lights",_lightsZueModule);function Group(){this.id="";this.name="";this.lights=[];this.bridge=undefined}Group.prototype.addLight=function(e){this.lights.push(e)};Group.prototype.toggle=function(){for(var e=0;e<this.lights.length;e++){this.lights[e].toggle()}};var _groupsZueModule=function(e){"use strict";var t=false;var r=[];var i="hardware";var n="name";var a="schedule";var s=function(t){for(var i=0;i<r.length;i++){if(r[i].name==t){return r[i]}}var n=new Group;n.name=t;r.push(n);e.triggerEvent(GROUP_ADDED,n);return n};var o=function(t){var r=t.name;var i="default";var n=r.split("/");if(n.length>1){i=n[0]}var a=s(i);a.addLight(t);e.triggerEvent(GROUP_LIGHT_ADDED,a)};var u=function(e){if(e===n){new GroupNameImplementation}};var h=function(r){t=r;if(t){e.on(LIGHT_ADDED,o)}};var g;var d=function(t){e.triggerEvent(GROUP_ADDED,t)};var l=function(t){e.triggerEvent(GROUP_LIGHT_ADDED,t)};return{useSoftGroups:h,getAllGroups:g,enableGroupImplementation:u,addGroup:d,addLightToGroup:l}};zue.attach("groups",_groupsZueModule);function GroupNameImplementation(){this.all_groups=[];this.zue_core=undefined}GroupNameImplementation.prototype.start=function(e){this.zue_core=e;this.zue_core.listenFor(LIGHT_ADDED,this.lightAdded,this)};GroupNameImplementation.prototype.getAGroup=function(e){for(var t=0;t<this.all_groups.length;t++){if(this.all_groups[t].name==e){return this.all_groups[t]}}var r=new Group;r.name=e;this.all_groups.push(r);zue.groups.addGroup(r);return r};GroupNameImplementation.prototype.lightAdded=function(e){var t=e.name;var r="default";var i=t.split("/");if(i.length>1){r=i[0]}var n=this.getAGroup(r);n.addLight(e);zue.groups.addLightToGroup(n)};zue.registerPlugin("SimulateGroupsByNames",new GroupNameImplementation);