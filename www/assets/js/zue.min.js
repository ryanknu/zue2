function PriorityQueue(e){this._comparator=e||PriorityQueue.DEFAULT_COMPARATOR;this._elements=[]}PriorityQueue.DEFAULT_COMPARATOR=function(e,t){if(e instanceof Number&&t instanceof Number){return e-t}else{e=e.toString();t=t.toString();if(e==t)return 0;return e>t?1:-1}};PriorityQueue.prototype.isEmpty=function(){return this.size()===0};PriorityQueue.prototype.peek=function(){if(this.isEmpty())throw new Error("PriorityQueue is empty");return this._elements[0]};PriorityQueue.prototype.deq=function(){var e=this.peek();var t=this._elements.pop();var r=this.size();if(r===0)return e;this._elements[0]=t;var i=0;while(i<r){var n=i;var o=2*i+1;var s=2*i+2;if(o<r&&this._compare(o,n)>0){n=o}if(s<r&&this._compare(s,n)>0){n=s}if(n===i)break;this._swap(n,i);i=n}return e};PriorityQueue.prototype.enq=function(e){var t=this._elements.push(e);var r=t-1;while(r>0){var i=Math.floor((r-1)/2);if(this._compare(r,i)<0)break;this._swap(i,r);r=i}return t};PriorityQueue.prototype.size=function(){return this._elements.length};PriorityQueue.prototype.forEach=function(e){return this._elements.forEach(e)};PriorityQueue.prototype._compare=function(e,t){return this._comparator(this._elements[e],this._elements[t])};PriorityQueue.prototype._swap=function(e,t){var r=this._elements[e];this._elements[e]=this._elements[t];this._elements[t]=r};function ZueAjax(){this.eventManager=undefined;this.defaults={method:"get",data:"",url:undefined,model:undefined,success:function(){},failure:function(){},trap:false,bridge:undefined};this.$=jQuery}ZueAjax.prototype.setEventManager=function(e){this.eventManager=e};ZueAjax.prototype.exec=function(e){var t=this.$;var r=t.extend({},this.defaults,e);var i=this.eventManager;var n={type:r.method,url:r.url,async:false,success:function(e){if(detectArray(e)){if(e.length==0){if(!r.trap){i.trigger(HUE_ERROR,{brige:r.bridge,type:10001,description:"empty result set"})}r.failure()}for(var n in e){if(e.hasOwnProperty(n)){e[n]._i=n;if("error"in e[n]){if(!r.trap){var o=e[n].error;o.bridge=r.bridge;i.trigger(HUE_ERROR,o)}r.failure()}else{var s=t.extend(true,{},r.model);s.exchangeData(e[n]);r.success(s)}}}}else if(typeof e==="object"){if("error"in e){if(!r.trap){var o=e.error;o.bridge=r.bridge;i.trigger(HUE_ERROR,o)}r.failure()}else{r.model.exchangeData(e);r.success(r.model)}}else{throw"`data` is not something I can work with"}},error:function(){if(!r.trap){i.trigger(HUE_ERROR,{bridge:r.bridge,type:1e4,description:"no/bad response from server"})}r.failure()}};if(r.method=="post"||r.method=="put"){n.data=JSON.stringify(r.data)}t.ajax(n)};function ZueEventManager(){this.o={}}ZueEventManager.prototype.attach=function(e,t,r){var i=function(e,t){return e.priority>t.priority?1:-1};if(this.o[e]===undefined){this.o[e]=new PriorityQueue(i)}var n={};n.callback=t;n.object=r;n.priority=1;this.o[e].enq(n)};ZueEventManager.prototype.trigger=function(e,t){if(this.o[e]!==undefined){this.o[e].forEach(function(e){e.callback.call(e.object,t)})}};var HUE_ERROR="core.hue_error";var ERR_UNAUTHORIZED=1;var ERR_LINK_BUTTON_NOT_PRESSED=101;var LIGHT_ADDED="lights.light_added";var LIGHT_UPDATING="lights.light_updating";var LIGHT_UPDATED="lights.light_updated";var GROUP_ADDED="groups.group_added";var GROUP_LIGHT_ADDED="groups.light_added";var GROUP_UPDATING="groups.group_updating";var GROUP_UPDATED="groups.group_updated";var SCHEDULE_ADDED="schedules.schedule_added";var BRIDGE_FOUND="bridge.bridge_found";var NO_BRIDGE_FOUND="bridge.no_bridge_found";var LINK_SUCCESS="config.link_success";var LINK_FAILURE="config.link_failure";var LINK_BEGIN="config.link_begin";var LINKED="config.linked";String.prototype.pad=function(e,t){var r=e-this.length+1;if(r>0){return Array(r).join(t)+this}};var detectArray=function(e){if(e!==undefined&&!!e.shift){return true}if(typeof e!=="object"){return false}var t=false;for(var r in e){if(e.hasOwnProperty(r)){t=true;if(isNaN(parseInt(r,10))){return false}}}return t};function ZueCore(e,t){this.modules={};this.plugins={};this.IAjax=e;this.IAjax.setEventManager(t);this.IEventManager=t;this.log_target="#zue-debug";this.triggers=0;this.start=0}ZueCore.prototype.log=function(e){if(!this.start){this.start=Date.now()}if($(this.log_target).length){$(this.log_target).prepend($("<div/>").text((this.triggers++).toString().pad(3,"0")+" (T+"+(Date.now()-this.start).toString().pad(6,"0")+") "+e))}};ZueCore.prototype.attach=function(e,t){this.modules[e]=t(this);this[e]=this.modules[e]};ZueCore.prototype.enablePlugin=function(e){this.plugins[e].start(this)};ZueCore.prototype.registerPlugin=function(e,t){this.plugins[e]=t};ZueCore.prototype.triggerEvent=function(e,t,r){this.log("event: "+e+" Arg: "+JSON.stringify(t));this.IEventManager.trigger(e,t,r)};ZueCore.prototype.listenFor=function(e,t,r){this.IEventManager.attach(e,t,r)};ZueCore.prototype.on=function(e,t,r){this.listenFor(e,t,r)};ZueCore.prototype.ajaxExec=function(e){this.log("ajax:  "+(e.method||"get")+" "+e.url);this.IAjax.exec(e)};window.zue=new ZueCore(new ZueAjax,new ZueEventManager);function Bridge(){this.id="";this.internalipaddress="";this.macaddress="";this.hue_username=undefined;this.protocol="http";this.URL_API_PART="/api";this.error="";this.linking=false}Bridge.prototype.exchangeData=function(e){if("id"in e)this.id=e.id;if("internalipaddress"in e)this.internalipaddress=e.internalipaddress;if("macaddress"in e)this.macaddress=e.macaddress;if("hue_username"in e)this.hue_username=e.hue_username;if("error"in e)this.error=e.error.type;if("success"in e)this.hue_username=e.success.username};Bridge.prototype.assembleUrl=function(e){return this.protocol+"://"+this.internalipaddress+this.URL_API_PART+"/"+this.hue_username+e};Bridge.prototype.assembleRootUrl=function(){return this.protocol+"://"+this.internalipaddress+this.URL_API_PART};Bridge.prototype.getSafeMacAddress=function(){return this.macaddress.replace(/:/g,"")};var _bridgeZueModule=function(e){"use strict";var t="https://www.meethue.com/api/nupnp";var r=function(t){e.triggerEvent(BRIDGE_FOUND,t);return"_bridgeZueModule.foundBridge"};var i=function(){e.triggerEvent(NO_BRIDGE_FOUND);return"_bridgeZueModule.noBridgeFound"};var n=function(){var n=new Bridge;n=e.ajaxExec({url:t,model:n,success:r,failure:i,trap:true})};return{locate:n,_foundBridge:r,_noBridgeFound:i}};zue.attach("bridge",_bridgeZueModule);var _configZueModule=function(e){"use strict";var t=";zue-powered";var r=40;var i=6e4;var n=5e3;var o={};var s=function(t){e.triggerEvent(LINKED,t)};var a=function(t,r){e.triggerEvent(LINK_BEGIN,t);e.ajaxExec({url:t.assembleRootUrl(),method:"post",data:r,model:t,success:s,bridge:t})};var u=function(e){return{devicetype:e.substr(0,r-t.length)+t}};var h=function(e,t){a(e,u(t))};var g=function(e,t,r){var i=u(t);i.username=r;a(e,i)};return{createUser:g,createAnonUser:h,_createUser:a}};zue.attach("config",_configZueModule);function Light(){this.id="";this.name="";this.simple=true;this.state={on:false,bri:0,hue:0,sat:0,xy:[0,0],alert:"none",effect:"none",colormode:"hs",reachable:true};this.type="";this.modelid="";this.swversion="";this.pointsymbol={};this.bridge=undefined;this.color=undefined}Light.prototype.exchangeData=function(e){if("_i"in e&&!this.id)this.id=e._i;this.name=e.name||"";this.simple=!("state"in e);if(!this.simple){this.state=e.state;this.type=e.type;this.modelid=e.modelid;this.swversion=e.swversion;this.pointsymbol=e.pointsymbol}this.color=new Color(this)};Light.prototype.toggle=function(){zue.lights.updateLightState(this,{on:!this.state.on})};Light.prototype.setHue=function(e){zue.lights.updateLightState(this,{hue:e})};Light.prototype.setBri=function(e){zue.lights.updateLightState(this,{bri:e})};Light.prototype.setK=function(e){zue.lights.updateLightState(this,{ct:Math.floor(convertKToCt(e))})};Light.prototype.setSat=function(e){zue.lights.updateLightState(this,{sat:e})};Light.prototype.getId=function(){return"light-"+this.bridge.getSafeMacAddress()+"-"+this.id};function LightUpdateResponse(){this.light="";this.status="failure"}LightUpdateResponse.prototype.exchangeData=function(e){if("success"in e){this.status="success"}};var _lightsZueModule=function(e){"use strict";var t="/lights";var r="/state";var i=function(t){e.triggerEvent(LIGHT_ADDED,t)};var n=function(r){if(r.status=="success"){var i=r.light;var n=i.bridge.assembleUrl(t+"/"+i.id);e.ajaxExec({url:n,model:i,success:o})}};var o=function(t){e.triggerEvent(LIGHT_UPDATED,t)};var s=function(r){var n=r.assembleUrl(t);var o=new Light;o.bridge=r;e.ajaxExec({url:n,model:o,success:i,bridge:r})};var a=function(r){var n=r.bridge.assembleUrl(t+"/"+r.id);e.ajaxExec({url:n,model:r,success:i})};var u=function(i,o){var s=i.bridge.assembleUrl(t+"/"+i.id+r);var a=new LightUpdateResponse;a.light=i;e.triggerEvent(LIGHT_UPDATING,i);e.ajaxExec({url:s,model:a,method:"put",data:o,success:n})};return{getAllLights:s,getLightDetails:a,updateLightState:u}};zue.attach("lights",_lightsZueModule);function Group(){this.id="";this.name="";this.lights=[];this.bridge=undefined;this.type="group"}Group.prototype.addLight=function(e){this.lights.push(e)};Group.prototype.toggle=function(){for(var e=0;e<this.lights.length;e++){this.lights[e].toggle()}};Group.prototype.getId=function(){return"group-"+this.bridge.getSafeMacAddress()+"-"+this.id};var _groupsZueModule=function(e){"use strict";var t=false;var r=[];var i="hardware";var n="name";var o="schedule";var s=function(t){for(var i=0;i<r.length;i++){if(r[i].name==t){return r[i]}}var n=new Group;n.name=t;r.push(n);e.triggerEvent(GROUP_ADDED,n);return n};var a=function(t){var r=t.name;var i="default";var n=r.split("/");if(n.length>1){i=n[0]}var o=s(i);o.addLight(t);e.triggerEvent(GROUP_LIGHT_ADDED,o)};var u;var h=function(t){e.triggerEvent(GROUP_ADDED,t)};var g=function(t){e.triggerEvent(GROUP_LIGHT_ADDED,t)};return{getAllGroups:u,addGroup:h,addLightToGroup:g}};zue.attach("groups",_groupsZueModule);function GroupNameImplementation(){this.all_groups=[];this.zue_core=undefined}GroupNameImplementation.prototype.start=function(e){this.zue_core=e;this.zue_core.listenFor(LIGHT_ADDED,this.lightAdded,this)};GroupNameImplementation.prototype.getAGroup=function(e,t){for(var r=0;r<this.all_groups.length;r++){if(this.all_groups[r].name==e){return this.all_groups[r]}}var i=new Group;i.impl="impl_name";i.name=e;i.id=e;i.bridge=t;this.all_groups.push(i);zue.groups.addGroup(i);return i};GroupNameImplementation.prototype.lightAdded=function(e){var t=e.name;var r="default";var i=t.split("/");if(i.length>1){r=i[0]}var n=this.getAGroup(r,e.bridge);n.addLight(e);zue.groups.addLightToGroup(n)};zue.registerPlugin("SimulateGroupsByNames",new GroupNameImplementation);var HUE_MAX=65535;function Color(e){this.light=e.state}Color.prototype.supportsMode=function(e){if(e=="ct"){}else if(e=="hs"){}else if(e=="xy"){}return false};var hueToCss=function(e){var t=1;var r=1;var i=t*r;var n=i*(1-Math.abs(e/(HUE_MAX/6)%2-1));var o=t-i;var s=Math.floor(e/(HUE_MAX/6));var a={r:0,g:0,b:0};switch(s){case 0:a={r:i+o,g:n+o,b:0};break;case 1:a={g:i+o,r:n+o,b:0};break;case 2:a={g:i+o,b:n+o,r:0};break;case 3:a={b:i+o,g:n+o,r:0};break;case 4:a={b:i+o,r:n+o,g:0};break;case 5:a={r:i+o,b:n+o,g:0};break}var u=[Math.floor(a.r*255),Math.floor(a.g*255),Math.floor(a.b*255)];return"rgb("+u.join(",")+")"};var convertKToCt=function(e){return-347/4500*e+5888/9};var convertCtToK=function(e){return(e-5888/9)/(-347/4500)};var tempToCss=function(e){var t=e/100;r={r:0,g:0,b:0};if(t<66){r.r=255}else{r.r=t-60;r.r=329.698727446*(r.r^-.1332047592);r.r=Math.max(0,r.r);r.r=Math.min(255,r.r)}if(t<66){r.g=t;r.g=99.4708025861*Math.log(r.g)-161.1195681661}else{r.g=t-60;r.g=288.1221695283*(r.g^-.0755148492)}r.g=Math.max(0,r.g);r.g=Math.min(255,r.g);if(t>=66){r.b=255}else{if(t<=19){r.b=0}else{r.b=t-10;r.b=138.5177312231*Math.log(r.b)-305.0447927307;r.b=Math.max(0,r.b);r.b=Math.min(255,r.b)}}var i=[Math.floor(r.r),Math.floor(r.g),Math.floor(r.b)];return"rgb("+i.join(",")+")"};Color.prototype.getCss=function(){if(this.light.colormode=="hs"){return hueToCss(this.light.hue)}else if(this.light.colormode=="ct"){return tempToCss(convertCtToK(this.light.ct))}return"yellow"};Color.prototype.getTempInK=function(){return convertCtToK(this.light.ct)};Color.prototype.getHueInDegrees=function(){return this.light.hue/(HUE_MAX/360)};Color.prototype.toString=function(){if(this.light.colormode=="hs"){return this.getHueInDegrees().toFixed(2)+"°"}else if(this.light.colormode=="ct"){return Math.floor(this.getTempInK())+"K"}return"XY"};(function(){var e={HUE_RED:0,HUE_SALMON:6609,HUE_GREEN:32107,HUE_BLUE:44298,HUE_PURPLE:53333,HUE_AQUAMARINE:39242,HUE_YELLOW:18833,HUE_ORANGE:12879};if(window.zue===undefined){window.zue={color:e}}else{window.zue.color=e}})();function Schedule(){this.id="";this.name="";this.description="";this.command={};this.time="";this.simple=true}Schedule.prototype.exchangeData=function(e){this.id=e._i;this.name=e.name;this.description=e.description||"";this.simple=this.description.length<1;this.command=e.command||{};this.time=e.time||""};var _schedZueModule=function(e){"use strict";var t="/schedules";var r="/state";var i=function(t){e.triggerEvent(LIGHT_ADDED,t)};var n=function(t){if(t.status=="success"){var r=t.light;var i=r.bridge.assembleUrl(LIGHTS_URL_PART+"/"+r.id);e.ajaxExec({url:i,model:r,success:o})}};var o=function(t){e.triggerEvent(LIGHT_UPDATED,t)};var s=function(t){var r=t.assembleUrl(LIGHTS_URL_PART);var n=new Light;n.bridge=t;e.ajaxExec({url:r,model:n,success:i})};var a=function(t){var r=t.bridge.assembleUrl(LIGHTS_URL_PART+"/"+t.id);e.ajaxExec({url:r,model:t,success:i})};var u=function(i,o){var s=i.bridge.assembleUrl(t+"/"+i.id+r);var a=new LightUpdateResponse;a.light=i;e.triggerEvent(LIGHT_UPDATING,i);e.ajaxExec({url:s,model:a,method:"put",data:o,success:n})};var h=function(t){e.triggerEvent(SCHEDULE_ADDED,t)};var g=function(r){e.ajaxExec({url:r.assembleUrl(t),model:new Schedule,success:h})};return{getAllSchedules:g,getLightDetails:a,updateLightState:u}};zue.attach("schedules",_schedZueModule);