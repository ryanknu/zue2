function PriorityQueue(e){this._comparator=e||PriorityQueue.DEFAULT_COMPARATOR;this._elements=[]}PriorityQueue.DEFAULT_COMPARATOR=function(e,t){if(e instanceof Number&&t instanceof Number){return e-t}else{e=e.toString();t=t.toString();if(e==t)return 0;return e>t?1:-1}};PriorityQueue.prototype.isEmpty=function(){return this.size()===0};PriorityQueue.prototype.peek=function(){if(this.isEmpty())throw new Error("PriorityQueue is empty");return this._elements[0]};PriorityQueue.prototype.deq=function(){var e=this.peek();var t=this._elements.pop();var r=this.size();if(r===0)return e;this._elements[0]=t;var i=0;while(i<r){var n=i;var s=2*i+1;var a=2*i+2;if(s<r&&this._compare(s,n)>0){n=s}if(a<r&&this._compare(a,n)>0){n=a}if(n===i)break;this._swap(n,i);i=n}return e};PriorityQueue.prototype.enq=function(e){var t=this._elements.push(e);var r=t-1;while(r>0){var i=Math.floor((r-1)/2);if(this._compare(r,i)<0)break;this._swap(i,r);r=i}return t};PriorityQueue.prototype.size=function(){return this._elements.length};PriorityQueue.prototype.forEach=function(e){return this._elements.forEach(e)};PriorityQueue.prototype._compare=function(e,t){return this._comparator(this._elements[e],this._elements[t])};PriorityQueue.prototype._swap=function(e,t){var r=this._elements[e];this._elements[e]=this._elements[t];this._elements[t]=r};var isPlainObject=function(e){if(jQuery.type(e)!=="object"||e.nodeType||e!=null&&e===e.window){return false}if(e.constructor&&!e.constructor.prototype.hasOwnProperty("isPropertyOf")){return false}return true};var extend=function(){var e,t,r,i,n,s,a=arguments[0]||{},o=1,u=arguments.length,h=false;if(typeof a==="boolean"){h=a;a=arguments[o]||{};o++}if(typeof a!=="object"&&typeof a!=="function"){a={}}if(o===u){a=this;o--}for(;o<u;o++){if((e=arguments[o])!=null){for(t in e){r=a[t];i=e[t];if(a===i){continue}if(h&&i&&(isPlainObject(i)||(n=Array.isArray(i)))){if(n){n=false;s=r&&Array.isArray(r)?r:[]}else{s=r&&isPlainObject(r)?r:{}}a[t]=extend(h,s,i)}else if(i!==undefined){a[t]=i}}}}return a};function ZueAjax(){this.eventManager=undefined;this.defaults={method:"get",data:"",url:undefined,model:undefined,success:function(){},failure:function(){},trap:false,bridge:undefined};this.$=jQuery}ZueAjax.prototype.setEventManager=function(e){this.eventManager=e};ZueAjax.prototype.exec=function(e){var t=extend({},this.defaults,e);var r=this.eventManager;var i=t.method||"get";var n=function(e){var t={failed:true,type:10001,message:"Unknown error",data:undefined};t.data=typeof s.response==="string"?JSON.parse(s.response):s.response;if(s.status<200||s.status>299){t.message="Expected 200, got "+s.status;return t}if(!detectArray(t.data)){t.data=[t.data]}if(t.data.length<1){t.message="empty result set";t.type=10002;return t}for(var r in t.data){if(!t.data.hasOwnProperty(r))continue;t.data[r]._i=r;if("error"in t.data[r]){t.message=t.data[r].error.description;t.type=t.data[r].error.type;return t}}t.failed=false;return t};var s=new XMLHttpRequest;s.timeout=3e4;s.ontimeout=t.failed;s.responseType="json";s.onreadystatechange=function(){if(s.readyState==4){var e=n(s);if(e.failed){if(!t.trap){r.trigger(HUE_ERROR,{bridge:t.bridge,type:e.type,description:e.message})}return t.failure()}var i=e.data;for(var a in i){var o=extend(true,{},t.model);o.exchangeData(i[a]);t.success(o)}}};s.open(i,t.url);if(t.method=="post"||t.method=="put"){s.setRequestHeader("Content-Type","application/json");s.setRequestHeader("Accept","application/json");s.send(JSON.stringify(t.data))}else{s.send()}};function ZueEventManager(){this.o={}}ZueEventManager.prototype.attach=function(e,t,r){var i=function(e,t){return e.priority>t.priority?1:-1};if(this.o[e]===undefined){this.o[e]=new PriorityQueue(i)}var n={};n.callback=t;n.object=r;n.priority=1;this.o[e].enq(n)};ZueEventManager.prototype.trigger=function(e,t){if(this.o[e]!==undefined){this.o[e].forEach(function(e){e.callback.call(e.object,t)})}};var HUE_ERROR="core.hue_error";var ERR_UNAUTHORIZED=1;var ERR_LINK_BUTTON_NOT_PRESSED=101;var LIGHT_ADDED="lights.light_added";var LIGHT_UPDATING="lights.light_updating";var LIGHT_UPDATED="lights.light_updated";var GROUP_ADDED="groups.group_added";var GROUP_LIGHT_ADDED="groups.light_added";var GROUP_UPDATING="groups.group_updating";var GROUP_UPDATED="groups.group_updated";var SCHEDULE_ADDED="schedules.schedule_added";var BRIDGE_FOUND="bridge.bridge_found";var NO_BRIDGE_FOUND="bridge.no_bridge_found";var LINK_SUCCESS="config.link_success";var LINK_FAILURE="config.link_failure";var LINK_BEGIN="config.link_begin";var LINKED="config.linked";function _Z(e,t){var r=[];for(var i=0;i<e.length;i++){r.push(zue.di[e[i]])}t.apply(null,r)}var detectArray=function(e){if(e!==undefined&&!!e.shift){return true}if(typeof e!=="object"){return false}var t=false;for(var r in e){if(e.hasOwnProperty(r)){t=true;if(isNaN(parseInt(r,10))){return false}}}return t};(function(){"use strict";String.prototype.pad=function(e,t){var r=e-this.length+1;if(r>0){return Array(r).join(t)+this}};function e(e,t){this.modules={};this.plugins={};this.IAjax=e;this.IAjax.setEventManager(t);this.IEventManager=t;this.log_target="#zue-debug";this.triggers=0;this.start=0}var t=function(e){if(!o){o=Date.now()}if($(s).length){$(s).prepend($("<div/>").text((a++).toString().pad(3,"0")+" (T+"+(Date.now()-o).toString().pad(6,"0")+") "+e))}};e.prototype.attach=function(e,t){this.modules[e]=t;this[e]=this.modules[e]};e.prototype.enablePlugin=function(e){this.plugins[e].start(this)};e.prototype.registerPlugin=function(e,t){this.plugins[e]=t};var r=function(e,r,i){t("event: "+e+" Arg: "+JSON.stringify(r));n.trigger(e,r,i)};e.prototype.listenFor=function(e,t,r){this.IEventManager.attach(e,t,r)};e.prototype.on=function(e,t,r){this.listenFor(e,t,r)};e.prototype.ajaxExec=function(e){this.log("ajax:  "+(e.method||"get")+" "+e.url);this.IAjax.exec(e)};var i=new ZueAjax,n=new ZueEventManager,s="#zue-debug",a=0,o=0,u=[],h={};var c=function(e,t){u.push(e);zue.di[e]=t};var g=function(e,t){h[e]=t};var d=function(e){h[e]()};var l=function(e,t,r){n.attach(e,t,r)};var f=function(e){t("ajax:  "+(e.method||"get")+" "+e.url);i.exec(e)};i.setEventManager(n);var p={di:{},register:c,triggerEvent:r,listenFor:l,on:l,ajaxExec:f,registerPlugin:g,enablePlugin:d};p.di.core=window.zue=p})();function Bridge(){this.id="";this.internalipaddress="";this.macaddress="";this.hue_username=undefined;this.protocol="http";this.URL_API_PART="/api";this.error="";this.linking=false}Bridge.prototype.exchangeData=function(e){if("id"in e)this.id=e.id;if("internalipaddress"in e)this.internalipaddress=e.internalipaddress;if("macaddress"in e)this.macaddress=e.macaddress;if("hue_username"in e)this.hue_username=e.hue_username;if("error"in e)this.error=e.error.type;if("success"in e)this.hue_username=e.success.username};Bridge.prototype.assembleUrl=function(e){return this.protocol+"://"+this.internalipaddress+this.URL_API_PART+"/"+this.hue_username+e};Bridge.prototype.assembleRootUrl=function(){return this.protocol+"://"+this.internalipaddress+this.URL_API_PART};Bridge.prototype.getSafeMacAddress=function(){return this.macaddress.replace(/:/g,"")};_Z(["core"],function(e){"use strict";var t="https://www.meethue.com/api/nupnp";var r=function(t){e.triggerEvent(BRIDGE_FOUND,t);return"_bridgeZueModule.foundBridge"};var i=function(){e.triggerEvent(NO_BRIDGE_FOUND);return"_bridgeZueModule.noBridgeFound"};var n=function(){var n=new Bridge;n=e.ajaxExec({url:t,model:n,success:r,failure:i,trap:true})};e.register("bridge",{locate:n,_foundBridge:r,_noBridgeFound:i})});_Z(["core"],function(e){"use strict";var t=";zue-powered";var r=40;var i=6e4;var n=5e3;var s={};var a=function(t){e.triggerEvent(LINKED,t)};var o=function(t,r){e.triggerEvent(LINK_BEGIN,t);e.ajaxExec({url:t.assembleRootUrl(),method:"post",data:r,model:t,success:a,bridge:t})};var u=function(e){return{devicetype:e.substr(0,r-t.length)+t}};var h=function(e,t){o(e,u(t))};var c=function(e,t,r){var i=u(t);i.username=r;o(e,i)};e.register("config",{createUser:c,createAnonUser:h,_createUser:o})});function Light(){this.id="";this.name="";this.simple=true;this.state={on:false,bri:0,hue:0,sat:0,xy:[0,0],alert:"none",effect:"none",colormode:"hs",reachable:true};this.type="";this.modelid="";this.swversion="";this.pointsymbol={};this.bridge=undefined;this.color=undefined}Light.prototype.exchangeData=function(e){if("_i"in e&&!this.id)this.id=e._i;this.name=e.name||"";this.simple=!("state"in e);if(!this.simple){this.state=e.state;this.type=e.type;this.modelid=e.modelid;this.swversion=e.swversion;this.pointsymbol=e.pointsymbol}this.color=new Color(this)};Light.prototype.toggle=function(){zue.lights.updateLightState(this,{on:!this.state.on})};Light.prototype.setHue=function(e){zue.lights.updateLightState(this,{hue:e})};Light.prototype.setBri=function(e){zue.lights.updateLightState(this,{bri:e})};Light.prototype.setK=function(e){zue.lights.updateLightState(this,{ct:Math.floor(convertKToCt(e))})};Light.prototype.setSat=function(e){zue.lights.updateLightState(this,{sat:e})};Light.prototype.getId=function(){return"light-"+this.bridge.getSafeMacAddress()+"-"+this.id};function LightUpdateResponse(){this.light="";this.status="failure"}LightUpdateResponse.prototype.exchangeData=function(e){if("success"in e){this.status="success"}};_Z(["core"],function(){});_Z(["core"],function(e){"use strict";var t="/lights";var r="/state";var i=function(t){e.triggerEvent(LIGHT_ADDED,t)};var n=function(r){if(r.status=="success"){var i=r.light;var n=i.bridge.assembleUrl(t+"/"+i.id);e.ajaxExec({url:n,model:i,success:s})}};var s=function(t){e.triggerEvent(LIGHT_UPDATED,t)};var a=function(r){var n=r.assembleUrl(t);var s=new Light;s.bridge=r;e.ajaxExec({url:n,model:s,success:i,bridge:r})};var o=function(r){var n=r.bridge.assembleUrl(t+"/"+r.id);e.ajaxExec({url:n,model:r,success:i})};var u=function(i,s){var a=i.bridge.assembleUrl(t+"/"+i.id+r);var o=new LightUpdateResponse;o.light=i;e.triggerEvent(LIGHT_UPDATING,i);e.ajaxExec({url:a,model:o,method:"put",data:s,success:n})};e.register("lights",{getAllLights:a,getLightDetails:o,updateLightState:u})});function Group(){this.id="";this.name="";this.lights=[];this.bridge=undefined;this.type="group"}Group.prototype.addLight=function(e){this.lights.push(e)};Group.prototype.toggle=function(){for(var e=0;e<this.lights.length;e++){this.lights[e].toggle()}};Group.prototype.getId=function(){return"group-"+this.bridge.getSafeMacAddress()+"-"+this.id};_Z(["core"],function(e){"use strict";var t=false;var r=[];var i="hardware";var n="name";var s="schedule";var a=function(t){for(var i=0;i<r.length;i++){if(r[i].name==t){return r[i]}}var n=new Group;n.name=t;r.push(n);e.triggerEvent(GROUP_ADDED,n);return n};var o=function(t){var r=t.name;var i="default";var n=r.split("/");if(n.length>1){i=n[0]}var s=a(i);s.addLight(t);e.triggerEvent(GROUP_LIGHT_ADDED,s)};var u;var h=function(t){e.triggerEvent(GROUP_ADDED,t)};var c=function(t){e.triggerEvent(GROUP_LIGHT_ADDED,t)};e.register("groups",{getAllGroups:u,addGroup:h,addLightToGroup:c})});_Z(["core","groups"],function(e,t){var r=[];var i=function(e){var r=e.name,i="default".parts=r.split("/"),s;if(parts.length>1){i=parts[0]}s=n(i,e.bridge);s.addLight(e);t.addLightToGroup(s)};var n=function(e,i){var n=0,s;for(;n<r.length;n++){if(r[n].name==e){return r[n]}}var s=new Group;s.impl="impl_name";s.name=e;s.id=e;s.bridge=i;r.push(s);t.addGroup(s);return s};e.registerPlugin("SimulateGroupsByNames",function(){e.listenFor(LIGHT_ADDED,i)})});var HUE_MAX=65535;function Color(e){this.light=e.state}Color.prototype.supportsMode=function(e){if(e=="ct"){}else if(e=="hs"){}else if(e=="xy"){}return false};var hueToCss=function(e){var t=1;var r=1;var i=t*r;var n=i*(1-Math.abs(e/(HUE_MAX/6)%2-1));var s=t-i;var a=Math.floor(e/(HUE_MAX/6));var o={r:0,g:0,b:0};switch(a){case 0:o={r:i+s,g:n+s,b:0};break;case 1:o={g:i+s,r:n+s,b:0};break;case 2:o={g:i+s,b:n+s,r:0};break;case 3:o={b:i+s,g:n+s,r:0};break;case 4:o={b:i+s,r:n+s,g:0};break;case 5:o={r:i+s,b:n+s,g:0};break}var u=[Math.floor(o.r*255),Math.floor(o.g*255),Math.floor(o.b*255)];return"rgb("+u.join(",")+")"};var convertKToCt=function(e){return-347/4500*e+5888/9};var convertCtToK=function(e){return(e-5888/9)/(-347/4500)};var tempToCss=function(e){var t=e/100;r={r:0,g:0,b:0};if(t<66){r.r=255}else{r.r=t-60;r.r=329.698727446*(r.r^-.1332047592);r.r=Math.max(0,r.r);r.r=Math.min(255,r.r)}if(t<66){r.g=t;r.g=99.4708025861*Math.log(r.g)-161.1195681661}else{r.g=t-60;r.g=288.1221695283*(r.g^-.0755148492)}r.g=Math.max(0,r.g);r.g=Math.min(255,r.g);if(t>=66){r.b=255}else{if(t<=19){r.b=0}else{r.b=t-10;r.b=138.5177312231*Math.log(r.b)-305.0447927307;r.b=Math.max(0,r.b);r.b=Math.min(255,r.b)}}var i=[Math.floor(r.r),Math.floor(r.g),Math.floor(r.b)];return"rgb("+i.join(",")+")"};Color.prototype.getCss=function(){if(this.light.colormode=="hs"){return hueToCss(this.light.hue)}else if(this.light.colormode=="ct"){return tempToCss(convertCtToK(this.light.ct))}return"yellow"};Color.prototype.getTempInK=function(){return convertCtToK(this.light.ct)};Color.prototype.getHueInDegrees=function(){return this.light.hue/(HUE_MAX/360)};Color.prototype.toString=function(){if(this.light.colormode=="hs"){return this.getHueInDegrees().toFixed(2)+"Â°"}else if(this.light.colormode=="ct"){return Math.floor(this.getTempInK())+"K"}return"XY"};(function(){var e={HUE_RED:0,HUE_SALMON:6609,HUE_GREEN:32107,HUE_BLUE:44298,HUE_PURPLE:53333,HUE_AQUAMARINE:39242,HUE_YELLOW:18833,HUE_ORANGE:12879};if(window.zue===undefined){window.zue={color:e}}else{window.zue.color=e}})();function Schedule(){this.id="";this.name="";this.description="";this.command={};this.time="";this.simple=true}Schedule.prototype.exchangeData=function(e){this.id=e._i;this.name=e.name;this.description=e.description||"";this.simple=this.description.length<1;this.command=e.command||{};this.time=e.time||""};_Z("schedules",function(e){"use strict";var t="/schedules";var r="/state";var i=function(t){e.triggerEvent(LIGHT_ADDED,t)};var n=function(t){if(t.status=="success"){var r=t.light;var i=r.bridge.assembleUrl(LIGHTS_URL_PART+"/"+r.id);e.ajaxExec({url:i,model:r,success:s})}};var s=function(t){e.triggerEvent(LIGHT_UPDATED,t)};var a=function(t){var r=t.assembleUrl(LIGHTS_URL_PART);var n=new Light;n.bridge=t;e.ajaxExec({url:r,model:n,success:i})};var o=function(t){var r=t.bridge.assembleUrl(LIGHTS_URL_PART+"/"+t.id);e.ajaxExec({url:r,model:t,success:i})};var u=function(i,s){var a=i.bridge.assembleUrl(t+"/"+i.id+r);var o=new LightUpdateResponse;o.light=i;e.triggerEvent(LIGHT_UPDATING,i);e.ajaxExec({url:a,model:o,method:"put",data:s,success:n})};var h=function(t){e.triggerEvent(SCHEDULE_ADDED,t)};var c=function(r){e.ajaxExec({url:r.assembleUrl(t),model:new Schedule,success:h})};zue.register("schedules",{getAllSchedules:c,getLightDetails:o,updateLightState:u})});